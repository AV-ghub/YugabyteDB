–ü–æ–Ω—è–ª –ø—Ä–æ–±–ª–µ–º—É! –û—à–∏–±–∫–∞ `system.transactions not found` —É–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ **—Å–∏—Å—Ç–µ–º–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥ YSQL –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω**, –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ä–∞–±–æ—Ç–∞—é—â–∏–π Postgres –ø—Ä–æ—Ü–µ—Å—Å. –≠—Ç–æ —Ä–µ–¥–∫–∞—è —Å–∏—Ç—É–∞—Ü–∏—è, –Ω–æ —Ä–µ—à–∞–µ–º–∞—è.

### üîß –†–µ—à–µ–Ω–∏–µ: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è YSQL

–ù—É–∂–Ω–æ –∑–∞—Å—Ç–∞–≤–∏—Ç—å TServer –∑–∞–Ω–æ–≤–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å YSQL —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã. –í–æ—Ç –ø–æ—à–∞–≥–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ:

```bash
# 1. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º TServer (–Ω–µ —Ç—Ä–æ–≥–∞—è –º–∞—Å—Ç–µ—Ä—ã)
docker-compose stop yb-tserver-n1

# 2. –£–¥–∞–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ YSQL (—Ç–æ–ª—å–∫–æ YSQL –¥–∞–Ω–Ω—ã–µ, –Ω–µ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ TServer)
docker exec yugabyte-yb-master-n1-1 yb-admin --master_addresses yb-master-n1:7100,yb-master-n2:7100,yb-master-n3:7100 delete_ysql_catalog

# 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º TServer —Å —Ñ–ª–∞–≥–æ–º –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
docker-compose up -d yb-tserver-n1

# 4. –ñ–¥–µ–º 60-90 —Å–µ–∫—É–Ω–¥ –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
sleep 90

# 5. –ü—Ä–æ–≤–µ—Ä—è–µ–º
psql -h localhost -p 5433 -U yugabyte -c "SELECT version();"
```

### üõ†Ô∏è –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥: –ø–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å

–ï—Å–ª–∏ –ø–µ—Ä–≤—ã–π —Å–ø–æ—Å–æ–± –Ω–µ –ø–æ–º–æ–∂–µ—Ç, —Å–¥–µ–ª–∞–µ–º –ø–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å:

```bash
# 1. –ü–æ–ª–Ω–æ—Å—Ç—å—é –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏ –æ—á–∏—â–∞–µ–º –∫–ª–∞—Å—Ç–µ—Ä
docker-compose down -v

# 2. –£–¥–∞–ª—è–µ–º –≤—Å–µ —Ç–æ–º–∞
docker volume prune -f

# 3. –ü–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ–º docker-compose.yml —Å –≤–∞–∂–Ω—ã–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º
cat > docker-compose.yml << 'EOF'
version: '3.8'

services:
  yb-master-n1:
    image: yugabytedb/yugabyte:latest
    command:
      - "/home/yugabyte/bin/yb-master"
      - "--fs_data_dirs=/mnt/master"
      - "--master_addresses=yb-master-n1:7100,yb-master-n2:7100,yb-master-n3:7100"
      - "--rpc_bind_addresses=yb-master-n1:7100"
    mem_limit: 1024m

  yb-master-n2:
    image: yugabytedb/yugabyte:latest
    command:
      - "/home/yugabyte/bin/yb-master"
      - "--fs_data_dirs=/mnt/master"
      - "--master_addresses=yb-master-n1:7100,yb-master-n2:7100,yb-master-n3:7100"
      - "--rpc_bind_addresses=yb-master-n2:7100"
    mem_limit: 1024m

  yb-master-n3:
    image: yugabytedb/yugabyte:latest
    command:
      - "/home/yugabyte/bin/yb-master"
      - "--fs_data_dirs=/mnt/master"
      - "--master_addresses=yb-master-n1:7100,yb-master-n2:7100,yb-master-n3:7100"
      - "--rpc_bind_addresses=yb-master-n3:7100"
    mem_limit: 1024m

  yb-tserver-n1:
    image: yugabytedb/yugabyte:latest
    command:
      - "/home/yugabyte/bin/yb-tserver"
      - "--fs_data_dirs=/mnt/tserver"
      - "--tserver_master_addrs=yb-master-n1:7100,yb-master-n2:7100,yb-master-n3:7100"
      - "--rpc_bind_addresses=yb-tserver-n1:9100"
      - "--enable_ysql=true"
      - "--ysql_enable_auth=false"
      - "--ysql_num_shards_per_tserver=2"  # –£–º–µ–Ω—å—à–∞–µ–º –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Å—Ä–µ–¥—ã
      - "--replication_factor=1"           # –î–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞
    ports:
      - "5433:5433"
      - "7000:7000"
    depends_on:
      - yb-master-n1
      - yb-master-n2
      - yb-master-n3
    mem_limit: 2048m
    # –ñ–¥–µ–º –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –º–∞—Å—Ç–µ—Ä–æ–≤
    healthcheck:
      test: ["CMD-SHELL", "yb-admin --master_addresses yb-master-n1:7100,yb-master-n2:7100,yb-master-n3:7100 list_all_masters 2>/dev/null | grep -q LEADER"]
      interval: 10s
      timeout: 10s
      retries: 15
      start_period: 30s
EOF

# 4. –ó–∞–ø—É—Å–∫–∞–µ–º
docker-compose up -d

# 5. –ñ–¥–µ–º –î–û–õ–¨–®–ï - 2-3 –º–∏–Ω—É—Ç—ã –¥–ª—è –ø–æ–ª–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
echo "–ñ–¥–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞..."
sleep 180

# 6. –ü—Ä–æ–≤–µ—Ä—è–µ–º
psql -h localhost -p 5433 -U yugabyte -c "SELECT version();"
psql -h localhost -p 5433 -U yugabyte -c "CREATE TABLE test_final (id INT PRIMARY KEY);"
```

### üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–µ—Ä–µ–¥ –¥–µ–π—Å—Ç–≤–∏—è–º–∏

–î–∞–≤–∞–π—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ YSQL:

```bash
# –°–º–æ—Ç—Ä–∏–º –ª–æ–≥–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ YSQL
docker exec yugabyte-yb-tserver-n1-1 cat /mnt/tserver/yb-data/tserver/logs/postgresql-*.log | grep -i "init\|catalog\|system" | tail -20

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü YSQL
docker exec yugabyte-yb-tserver-n1-1 find /mnt/tserver -name "pg_*" -type d | head -5
```

### üìä –ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç

–û—à–∏–±–∫–∞ `system.transactions not found` –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ:
1. TServer –ø—ã—Ç–∞–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –¥–ª—è –≤–∞—à–µ–≥–æ `CREATE TABLE`
2. –î–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–∞ —Å–∏—Å—Ç–µ–º–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
3. –≠—Ç–∞ —Ç–∞–±–ª–∏—Ü–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ YSQL
4. –ü–æ –∫–∞–∫–æ–π-—Ç–æ –ø—Ä–∏—á–∏–Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–µ –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å

**–ö–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –Ω–æ–≤–æ–º –∫–æ–Ω—Ñ–∏–≥–µ:**
- `--replication_factor=1` ‚Äî —É–ø—Ä–æ—â–∞–µ—Ç –∫–ª–∞—Å—Ç–µ—Ä –¥–ª—è —Ç–µ—Å—Ç–æ–≤
- `--ysql_num_shards_per_tserver=2` ‚Äî —É–º–µ–Ω—å—à–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É
- `healthcheck` ‚Äî –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ TServer –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –º–∞—Å—Ç–µ—Ä–æ–≤

### üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

**–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–∞—á–∞–ª–∞ –ø–µ—Ä–≤—ã–π —Å–ø–æ—Å–æ–±** (–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ TServer + `delete_ysql_catalog`), –æ–Ω –º–µ–Ω–µ–µ —Ä–∞–∑—Ä—É—à–∏—Ç–µ–ª—å–Ω—ã–π. –ï—Å–ª–∏ –Ω–µ –ø–æ–º–æ–∂–µ—Ç ‚Äî —Ç–æ–≥–¥–∞ –ø–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å —Å–æ –≤—Ç–æ—Ä—ã–º —Å–ø–æ—Å–æ–±–æ–º.

**–ö–∞–∫–æ–π —Å–ø–æ—Å–æ–± –ø—Ä–æ–±—É–µ—Ç–µ –ø–µ—Ä–≤—ã–º?** –°–æ–æ–±—â–∏—Ç–µ –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö –∫–∞–∂–¥–æ–π –∫–æ–º–∞–Ω–¥—ã, —á—Ç–æ–±—ã —è –º–æ–≥ –≤–∏–¥–µ—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å.
