```
–∞ –µ—Å–ª–∏ –ø—Ä–æ—Å—Ç–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å docker-compose, –ø–æ–º–µ–Ω—è—Ç—å –∫–æ–Ω—Ñ–∏–≥ –∏ —Å—Ç–∞—Ä—Ç–∞–Ω—É—Ç—å?
```
**–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å! –≠—Ç–æ —Å–∞–º—ã–π –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥.** –î–∞, –º–æ–∂–Ω–æ (–∏ –Ω—É–∂–Ω–æ) –ø—Ä–æ—Å—Ç–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å, –æ–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å. –ù–æ –µ—Å—Ç—å **–Ω—é–∞–Ω—Å—ã**, –æ –∫–æ—Ç–æ—Ä—ã—Ö –≤–∞–∂–Ω–æ –∑–Ω–∞—Ç—å.

### ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥–∞

```bash
# 1. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º (–ù–û –ù–ï –£–î–ê–õ–Ø–ï–ú –¥–∞–Ω–Ω—ã–µ!)
docker-compose stop

# 2. –ú–µ–Ω—è–µ–º docker-compose.yml
# 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º
docker-compose up -d

# 4. –ñ–¥–µ–º –ø–µ—Ä–µ–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
sleep 60
```

### ‚ö†Ô∏è **–í–∞–∂–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —ç—Ç–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞:**

| –ß—Ç–æ –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å | –ß—Ç–æ –Ω–µ–ª—å–∑—è –º–µ–Ω—è—Ç—å –±–µ–∑ –æ—á–∏—Å—Ç–∫–∏ |
|------------------|-----------------------------|
| –ü–æ—Ä—Ç –Ω–∞—Ä—É–∂—É (`5433:5433` ‚Üí `5434:5433`) | –ò–º—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (–µ—Å–ª–∏ –Ω–µ —É–¥–∞–ª—è—Ç—å —Å—Ç–∞—Ä—ã–π) |
| `mem_limit` | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∞—Å—Ç–µ—Ä-—É–∑–ª–æ–≤ |
| –§–ª–∞–≥–∏ –∑–∞–ø—É—Å–∫–∞ | `replication_factor` (–µ—Å–ª–∏ —É–∂–µ —Å–æ–∑–¥–∞–Ω—ã —Ç–∞–±–ª–∏—Ü—ã) |
| –í–µ—Ä—Å–∏—è –æ–±—Ä–∞–∑–∞ | –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–ª–∞—Å—Ç–µ—Ä–∞ (1‚Üí3 TServer) |

### üîß **–í–∞—à –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å–ª—É—á–∞–π: –ø–µ—Ä–µ—Ö–æ–¥ —Å –ø—Ä–æ–±–ª–µ–º–Ω–æ–≥–æ –Ω–∞ —Ä–∞–±–æ—á–∏–π –∫–æ–Ω—Ñ–∏–≥**

–î–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ —Å —Ç–µ–∫—É—â–µ–≥–æ "–ø–æ–ª–æ–º–∞–Ω–Ω–æ–≥–æ" —Å–æ—Å—Ç–æ—è–Ω–∏—è –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥:

```bash
# 1. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –í–°–Å
docker-compose stop

# 2. –ë—ç–∫–∞–ø –¥–∞–Ω–Ω—ã—Ö (–µ—Å–ª–∏ –æ–Ω–∏ –≤–∞–∂–Ω—ã)
docker run --rm -v yugabyte_yb-tserver1_data:/data -v $(pwd):/backup alpine tar czf /backup/yb-backup-$(date +%s).tar.gz -C /data .

# 3. –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–µ–º —Å—Ç–∞—Ä—ã–π docker-compose.yml
mv docker-compose.yml docker-compose.yml.old

# 4. –°–æ–∑–¥–∞–µ–º –ù–û–í–´–ô –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π docker-compose.yml
cat > docker-compose.yml << 'EOF'
version: '3.8'

services:
  yb-master:
    image: yugabytedb/yugabyte:latest
    command:
      - "/home/yugabyte/bin/yb-master"
      - "--fs_data_dirs=/mnt/master"
      - "--master_addresses=yb-master:7100"
      - "--rpc_bind_addresses=yb-master:7100"
      - "--replication_factor=3"
    mem_limit: 1024m
    ports:
      - "7000:7000"

  yb-tserver-a:
    image: yugabytedb/yugabyte:latest
    command:
      - "/home/yugabyte/bin/yb-tserver"
      - "--fs_data_dirs=/mnt/tserver"
      - "--tserver_master_addrs=yb-master:7100"
      - "--rpc_bind_addresses=yb-tserver-a:9100"
      - "--enable_ysql"
      - "--ysql_enable_auth=false"
      - "--pgsql_proxy_bind_address=0.0.0.0:5433"
    ports:
      - "5433:5433"
    depends_on:
      - yb-master
    mem_limit: 2048m

  yb-tserver-b:
    image: yugabytedb/yugabyte:latest
    command:
      - "/home/yugabyte/bin/yb-tserver"
      - "--fs_data_dirs=/mnt/tserver"
      - "--tserver_master_addrs=yb-master:7100"
      - "--rpc_bind_addresses=yb-tserver-b:9100"
      - "--enable_ysql"
      - "--ysql_enable_auth=false"
      - "--pgsql_proxy_bind_address=0.0.0.0:5433"
    ports:
      - "5434:5433"
    depends_on:
      - yb-master
    mem_limit: 2048m

  yb-tserver-c:
    image: yugabytedb/yugabyte:latest
    command:
      - "/home/yugabyte/bin/yb-tserver"
      - "--fs_data_dirs=/mnt/tserver"
      - "--tserver_master_addrs=yb-master:7100"
      - "--rpc_bind_addresses=yb-tserver-c:9100"
      - "--enable_ysql"
      - "--ysql_enable_auth=false"
      - "--pgsql_proxy_bind_address=0.0.0.0:5433"
    ports:
      - "5435:5433"
    depends_on:
      - yb-master
    mem_limit: 2048m
EOF

# 5. –£–î–ê–õ–Ø–ï–ú –¢–û–õ–¨–ö–û —Å—Ç–∞—Ä—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã, –Ω–æ –°–û–•–†–ê–ù–Ø–ï–ú –¥–∞–Ω–Ω—ã–µ
docker-compose down  # —É–¥–∞–ª–∏—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã, –Ω–æ –ù–ï —Ç–æ–º–∞!

# 6. –ó–∞–ø—É—Å–∫–∞–µ–º –∑–∞–Ω–æ–≤–æ
docker-compose up -d

# 7. –ñ–¥–µ–º –ë–û–õ–¨–®–ï –æ–±—ã—á–Ω–æ–≥–æ (—Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—Ç—å—Å—è)
echo "–ñ–¥–µ–º 3 –º–∏–Ω—É—Ç—ã –¥–ª—è –ø–µ—Ä–µ–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞..."
sleep 180
```

### üéØ **–ü–æ—á–µ–º—É –≤ –≤–∞—à–µ–º —Å–ª—É—á–∞–µ –Ω—É–∂–µ–Ω –ø–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å:**

–í–∞—à –∫–ª–∞—Å—Ç–µ—Ä –≤ **–Ω–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏** –∏–∑-–∑–∞:
1. **RF=1 –ø—Ä–∏ 3 TServer** ‚Üí —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã —Ä–∞–∑–º–∞–∑–∞–Ω—ã, –Ω–æ –Ω–µ —Ä–µ–ø–ª–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã
2. **–¢–∞–±–ª–∏—Ü–∞ `transactions_system` –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∞**
3. **Raft –≥—Ä—É–ø–ø—ã –≤ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏**

### üîç **–ü—Ä–æ–≤–µ—Ä–∫–∞: –º–æ–∂–Ω–æ –ª–∏ "–ø–æ—á–∏–Ω–∏—Ç—å –Ω–∞ –ª–µ—Ç—É"?**

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:

```bash
# 1. –ö–∞–∫–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —É —Ç–∞–±–ª–∏—Ü—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π?
docker exec yugabyte_yb-master_1 yb-admin --master_addresses yb-master:7100 list_tables | grep -i trans

# 2. –°–∫–æ–ª—å–∫–æ —Ä–µ–ø–ª–∏–∫ —É –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü—ã?
docker exec yugabyte_yb-master_1 yb-admin --master_addresses yb-master:7100 list_tablets | head -5

# 3. –ö–∞–∫–æ–π replication_factor —Å–µ–π—á–∞—Å?
docker exec yugabyte_yb-master_1 yb-admin --master_addresses yb-master:7100 get_universe_config | grep -i replication
```

### ‚úÖ **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –∫–æ–º–ø—Ä–æ–º–∏—Å—Å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç**

–ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –≤ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω—ã:

```bash
# 1. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º
docker-compose stop

# 2. –£–¥–∞–ª—è–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –ò —Ç–æ–º–∞
docker-compose down -v

# 3. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥
# 4. –ó–∞–ø—É—Å–∫–∞–µ–º —Å —á–∏—Å—Ç–æ–≥–æ –ª–∏—Å—Ç–∞
docker-compose up -d
sleep 180
```

–ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –≤–∞–∂–Ω—ã:

```bash
# 1. –î–µ–ª–∞–µ–º snapshot —á–µ—Ä–µ–∑ yb-admin
docker exec yugabyte_yb-master_1 yb-admin --master_addresses yb-master:7100 create_snapshot ysql.yugabyte test_success

# 2. –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ ysql_dump
docker exec yugabyte_yb-tserver1_1 pg_dump -h localhost -U yugabyte yugabyte > backup.sql

# 3. –û—á–∏—â–∞–µ–º –≤—Å—ë
docker-compose down -v

# 4. –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–æ–≤—ã–π –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–ª–∞—Å—Ç–µ—Ä
# 5. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
psql -h localhost -p 5433 -U yugabyte yugabyte < backup.sql
```

### üí° **–í—ã–≤–æ–¥:**

–î–ª—è **—Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞** —Å –Ω–µ–∫—Ä–∏—Ç–∏—á–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ ‚Äî –ø—Ä–æ—â–µ –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë –∏ –Ω–∞—á–∞—Ç—å —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ñ–∏–≥–∞.

–î–ª—è **production** ‚Äî –Ω—É–∂–Ω–æ –º–µ–Ω—è—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ —à—Ç–∞—Ç–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã YugabyteDB (–∏–∑–º–µ–Ω–µ–Ω–∏–µ RF, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —É–∑–ª–æ–≤).
