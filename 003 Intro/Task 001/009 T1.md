–û—à–∏–±–∫–∏ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ PostGIS –≤ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä YugabyteDB —Å–≤—è–∑–∞–Ω—ã —Å –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å—é —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫. –¢–µ–∫—É—â–∏–π –æ–±—Ä–∞–∑ YugabyteDB (–Ω–∞—á–∏–Ω–∞—è —Å 2.19) –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ —Å–∏—Å—Ç–µ–º–µ —Å –±–æ–ª–µ–µ —Å—Ç–∞—Ä—ã–º–∏ –≤–µ—Ä—Å–∏—è–º–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫ (AlmaLinux 8/Rocky Linux 8), —á–µ–º —Ç—Ä–µ–±—É—é—Ç—Å—è PostGIS, —á—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π. –°—É—â–µ—Å—Ç–≤—É–µ—Ç –¥–≤–∞ –æ–±—Ö–æ–¥–Ω—ã—Ö –ø—É—Ç–∏, –Ω–æ –Ω–∏ –æ–¥–∏–Ω –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–º.

### üîß –î–≤–∞ –ø—É—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤ Docker

–í–æ—Ç –æ–±–∞ –º–µ—Ç–æ–¥–∞ –≤ —Ç–∞–±–ª–∏—Ü–µ. –ü–µ—Ä–≤—ã–π ‚Äî —É–ø—Ä–æ—â—ë–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è —Ä—É—á–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä–æ–µ –≤—ã –Ω–∞—á–∞–ª–∏. –í—Ç–æ—Ä–æ–π ‚Äî –º–µ—Ç–æ–¥ Dockerfile, –ø–æ–∑–≤–æ–ª—è—é—â–∏–π —Å–æ–∑–¥–∞—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω—ã–π –æ–±—Ä–∞–∑.

| –ú–µ—Ç–æ–¥ | –°—É—Ç—å | –°–ª–æ–∂–Ω–æ—Å—Ç—å | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è |
| :--- | :--- | :--- | :--- |
| **1. –†—É–∫–æ–π –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ** | –ó–∞–º–µ–Ω–∞ –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫ –Ω–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ –∏–∑ `centos:7` –ø—Ä—è–º–æ –≤ –∑–∞–ø—É—â–µ–Ω–Ω–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ. | –°—Ä–µ–¥–Ω—è—è | –î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è. |
| **2. –°–±–æ—Ä–∫–∞ Docker-–æ–±—Ä–∞–∑–∞** | –ú–Ω–æ–≥–æ—ç—Ç–∞–ø–Ω–∞—è —Å–±–æ—Ä–∫–∞: —Å–Ω–∞—á–∞–ª–∞ PostGIS –≤ –æ–±—Ä–∞–∑–µ —Å `centos:7`, –∑–∞—Ç–µ–º –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –≤ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑ YugabyteDB. | –í—ã—à–µ | –î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ, –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è. |

### üõ†Ô∏è –ú–µ—Ç–æ–¥ 1: –ë—ã—Å—Ç—Ä–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ –∑–∞–ø—É—â–µ–Ω–Ω–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
–≠—Ç–æ—Ç –º–µ—Ç–æ–¥ ‚Äî –∏–º–µ–Ω–Ω–æ —Ç–æ—Ç ¬´–µ—â–µ –æ–¥–∏–Ω –æ–±—Ö–æ–¥–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç¬ª, –∫–æ—Ç–æ—Ä—ã–π –≤—ã –∏—â–µ—Ç–µ. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—ã –∏–∑–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ `yugabyte_yb-tserver-a_1`, –≥–¥–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ PostGIS —Ä–∞–Ω–µ–µ –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å –æ—à–∏–±–∫–æ–π –∏–∑-–∑–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (–≤—Ä–æ–¥–µ `libgdal`).

1.  **–ó–∞–º–µ–Ω–∏—Ç–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏**. –≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ –≤–µ—Ä—Å–∏–∏ `libsqlite3` –∏ `libxml2` –∏–∑ –æ–±—Ä–∞–∑–∞ CentOS 7 –∏ –ø–æ–º–µ—â–∞–µ—Ç –∏—Ö –≤ –∫–∞—Ç–∞–ª–æ–≥ YugabyteDB.
    ```bash
    docker run --rm -i centos:7 bash -c "tar -C /usr/lib64 -h -cf - libsqlite3.so.0 libxml2.so.2.9.1" | \
      docker exec -i yugabyte_yb-tserver-a_1 bash -c "tar -C /home/yugabyte/postgres/../lib/yb-thirdparty -xvf -"
    ```
2.  **–í—ã–ø–æ–ª–Ω–∏—Ç–µ –ø–µ—Ä–µ–ª–∏–Ω–∫–æ–≤–∫—É –±–∏–±–ª–∏–æ—Ç–µ–∫** –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ:
    ```bash
    # 1. –ü–µ—Ä–µ–ª–∏–Ω–∫—É–π—Ç–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
    docker exec -it yugabyte_yb-tserver-a_1 /home/yugabyte/bin/post_install.sh -e
    # 2. –°–æ–∑–¥–∞–π—Ç–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ PostGIS
    docker exec -it yugabyte_yb-tserver-a_1 ./bin/ysqlsh -c "CREATE EXTENSION postgis;"
    # 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É
    docker exec -it yugabyte_yb-tserver-a_1 ./bin/ysqlsh -c "SELECT PostGIS_Full_Version();"
    ```

> ‚ö†Ô∏è **–í–∞–∂–Ω–æ**: –≠—Ç–æ **–≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ**. –ò–∑–º–µ–Ω–µ–Ω–∏—è –±—É–¥—É—Ç —É—Ç–µ—Ä—è–Ω—ã –ø—Ä–∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, –ø–æ—ç—Ç–æ–º—É –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞. –ï—Å–ª–∏ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ `CREATE EXTENSION` –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –Ω–æ–≤—ã–µ –æ—à–∏–±–∫–∏ –æ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, `libgdal`), –ø—Ä–æ—Ü–µ–¥—É—Ä—É –ø—Ä–∏–¥–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –¥–ª—è –Ω–∏—Ö.

### üê≥ –ú–µ—Ç–æ–¥ 2: –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞ —á–µ—Ä–µ–∑ Dockerfile
–≠—Ç–æ –±–æ–ª–µ–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥, —Å–æ–∑–¥–∞—é—â–∏–π –Ω–æ–≤—ã–π –æ–±—Ä–∞–∑, –≥–æ—Ç–æ–≤—ã–π –∫ –∑–∞–ø—É—Å–∫—É. –°—É—Ç—å –º–µ—Ç–æ–¥–∞ ‚Äî —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å PostGIS –≤ —Å—Ä–µ–¥–µ, —Å–æ–≤–º–µ—Å—Ç–∏–º–æ–π —Å GLIBC YugabyteDB (`centos:7`), –∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ —Ñ–∞–π–ª—ã –≤ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑.

1.  **–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `Dockerfile`** —Å–æ —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–º:
    ```dockerfile
    FROM yugabytedb/yugabyte:2.15.3.2-b1 as postgis-on-centos7
    RUN yum update -y
    RUN yum install -y https://download.postgresql.org/pub/repos/yum/reporpms/EL-7-x86_64/pgdg-redhat-repo-latest.noarch.rpm
    RUN yum -y install postgresql11-server postgis31_11 postgis31_11-client
    RUN cp /usr/pgsql-11/lib/postgis* /home/yugabyte/postgres/lib
    RUN cp /usr/pgsql-11/share/extension/postgis* /home/yugabyte/postgres/share/extension
    RUN /home/yugabyte/bin/post_install.sh -e

    FROM yugabytedb/yugabyte:latest
    COPY --from=postgis-on-centos7 /home/yugabyte/postgres/lib/postgis* /home/yugabyte/postgres/lib/
    COPY --from=postgis-on-centos7 /home/yugabyte/postgres/share/extension/postgis* /home/yugabyte/postgres/share/extension/
    RUN /home/yugabyte/bin/post_install.sh -e
    ```

2.  **–°–æ–±–µ—Ä–∏—Ç–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –Ω–æ–≤—ã–π –æ–±—Ä–∞–∑**:
    ```bash
    docker build -t yugabyte-with-postgis .
    # –û–±–Ω–æ–≤–∏—Ç–µ –≤–∞—à docker-compose.yml, —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å image: yugabyte-with-postgis
    docker-compose up -d
    ```

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –í –ø—Ä–∏–º–µ—Ä–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `postgis31_11`, –ø–æ—Ç–æ–º—É —á—Ç–æ YugabyteDB 2.15 (–ø–æ—Å–ª–µ–¥–Ω—è—è –Ω–∞ CentOS 7) —Å–æ–≤–º–µ—Å—Ç–∏–º–∞ —Å PostgreSQL 11. –î–ª—è –≤–∞—à–µ–π –≤–µ—Ä—Å–∏–∏ —É–±–µ–¥–∏—Ç–µ—Å—å –≤ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ (—Å–º. `./bin/postgres --version` –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ). –ú–µ—Ç–æ–¥ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç, –µ—Å–ª–∏ –≤—ã —Å–∫–æ–ø–∏—Ä—É–µ—Ç–µ —Ñ–∞–π–ª—ã –≤ —Ç—É –∂–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–∞—Ç–∞–ª–æ–≥–æ–≤.

### üíé –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
–ü–æ—Å–∫–æ–ª—å–∫—É –≤—ã —Ö–æ—Ç–∏—Ç–µ –∏–∑–±–µ–∂–∞—Ç—å –¥–æ–ª–≥–æ–π —Å–±–æ—Ä–∫–∏ –∏ —É–∂–µ —Å–æ–∑–¥–∞–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —á–µ—Ä–µ–∑ `docker-compose`, —Ä–µ–∫–æ–º–µ–Ω–¥—É—é —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–∏–º–µ–Ω–∏—Ç—å **–ú–µ—Ç–æ–¥ 1**. –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–∏–Ω—É—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ PostGIS –≤ –≤–∞—à–µ–π —Å—Ä–µ–¥–µ.

–ï—Å–ª–∏ –≤–∞–º –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø–æ–¥–æ–±–Ω—ã–µ –æ–±—Ä–∞–∑—ã —Ä–µ–≥—É–ª—è—Ä–Ω–æ –∏–ª–∏ –≤—ã –∑–∞—Ö–æ—Ç–∏—Ç–µ —É–±–µ–¥–∏—Ç—å—Å—è –≤ –∏—Ö —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏, —Å—Ç–æ–∏—Ç –ø–µ—Ä–µ–π—Ç–∏ –∫ **–ú–µ—Ç–æ–¥—É 2**.

–°–æ–æ–±—â–∏—Ç–µ, –∫–∞–∫–æ–π –º–µ—Ç–æ–¥ –≤—ã –≤—ã–±–µ—Ä–µ—Ç–µ –∏ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ —Å–æ–∑–¥–∞–Ω–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è? –≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç –¥–∞—Ç—å –¥–∞–ª—å–Ω–µ–π—à–∏–µ —Å–æ–≤–µ—Ç—ã –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ.
